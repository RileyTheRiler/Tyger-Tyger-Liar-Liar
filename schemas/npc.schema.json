{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "npc.schema.json",
  "title": "NPC",
  "description": "A non-player character with trust tracking and relationship mechanics",
  "type": "object",
  "required": ["id", "name"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the NPC",
      "pattern": "^npc_[a-z][a-z0-9_]*$"
    },
    "name": {
      "type": "string",
      "description": "Display name of the NPC"
    },
    "title": {
      "type": "string",
      "description": "Role or title (e.g., 'Local Sheriff', 'Hotel Manager')"
    },
    "description": {
      "type": "object",
      "required": ["base"],
      "properties": {
        "base": {"type": "string"},
        "lens": {
          "type": "object",
          "properties": {
            "believer": {"type": "string"},
            "skeptic": {"type": "string"},
            "haunted": {"type": "string"}
          }
        }
      }
    },
    "location_id": {
      "type": "string",
      "description": "Default location where NPC can be found"
    },
    "schedule": {
      "type": "object",
      "description": "Time-based location schedule",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "location": {"type": "string"},
          "available": {"type": "boolean", "default": true}
        }
      }
    },
    "initial_trust": {
      "type": "integer",
      "minimum": 0,
      "maximum": 100,
      "default": 50,
      "description": "Starting trust level"
    },
    "initial_fear": {
      "type": "integer",
      "minimum": 0,
      "maximum": 100,
      "default": 0,
      "description": "Starting fear level (optional mechanic)"
    },
    "trust_thresholds": {
      "type": "object",
      "description": "Trust levels that unlock specific content",
      "properties": {
        "hostile": {"type": "integer", "default": 20},
        "wary": {"type": "integer", "default": 40},
        "neutral": {"type": "integer", "default": 50},
        "friendly": {"type": "integer", "default": 70},
        "trusted": {"type": "integer", "default": 85}
      }
    },
    "dialogue_trees": {
      "type": "object",
      "description": "Dialogue tree IDs by trust level or condition",
      "additionalProperties": {"type": "string"}
    },
    "knowledge": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "topic": {"type": "string"},
          "trust_required": {"type": "integer"},
          "clue_revealed": {"type": "string"},
          "one_time": {"type": "boolean", "default": true}
        }
      },
      "description": "Information NPC can share at trust thresholds"
    },
    "secrets": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {"type": "string"},
          "description": {"type": "string"},
          "revealed_by": {
            "type": "object",
            "properties": {
              "trust_level": {"type": "integer"},
              "skill_check": {"type": "object"},
              "clue_presented": {"type": "string"},
              "theory_active": {"type": "string"}
            }
          }
        }
      }
    },
    "flags": {
      "type": "object",
      "additionalProperties": {"type": "boolean"},
      "description": "NPC-specific flags (alive, met, accused, etc.)"
    },
    "reactions": {
      "type": "object",
      "description": "How NPC reacts to specific events/flags",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "trust_modifier": {"type": "integer"},
          "fear_modifier": {"type": "integer"},
          "dialogue_override": {"type": "string"},
          "becomes_unavailable": {"type": "boolean"}
        }
      }
    },
    "critical_for": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Theory or ending IDs this NPC is critical for"
    },
    "portrait": {
      "type": "string",
      "description": "Path to portrait image"
    },
    "voice_style": {
      "type": "string",
      "description": "Description of speaking style for writing consistency"
    }
  }
}
